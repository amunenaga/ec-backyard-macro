VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "OrderSheet"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Option Explicit

Private Sub Worksheet_Change(ByVal Target As Range)
'アドインで書き込まれる最終列、最終行の変更を検出する
'WorkSheet_Changeイベントは変更があったセルを引数にとる。

'I1セルが空欄なら、アドイン前なので終了
If Range("L1").Value = "" Then Exit Sub

Dim LastRow As Long
LastRow = Range("A1").SpecialCells(xlCellTypeLastCell).Row

Dim CheckCell As Range
Set CheckCell = Intersect(Target, Cells(LastRow, 29))

'最終行のY列が変更されていない場合
If CheckCell Is Nothing Then Exit Sub

If CheckCell.Value = "" Then
    '最終行が棚無しで、アドインで何も出力されないときは、
    '末尾列であるY列を2行目までさかのぼって値が入っていないか調べる
    
    Dim i As Long
    For i = LastRow To 2 Step -1
        If Cells(i, 28).Value <> "" Then
            
            Exit For
        
        ElseIf i = 2 Then
        '全ての行でY列が空欄の時
            MsgBox "アドインで正しくデータが取得出来ていません｡"
            End
        
        End If
    Next

End If

'アドインで表示するステータスバーが残ってる場合がある
Application.StatusBar = False

Dim IsContinue As Integer
IsContinue = MsgBox("アドイン完了、ファイルを作成します。", vbOKCancel)

If IsContinue = vbOK Then

    Call Main.電算提出_振分けシート作成

Else

    MsgBox "マクロを終了します。"
    
    End

End If

End Sub

